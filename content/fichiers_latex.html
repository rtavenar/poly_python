
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Interaction avec des fichiers &#8212; Introduction à Python</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/betterpythonpad.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/vue.js"></script>
    <script src="../_static/pythonpad.bundle.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo_ur2.svg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Introduction à Python</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contenu du livre
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="struct.html">
   Structures de données et structures de contrôle
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dates.html">
   Les dates
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="listes.html">
   Les listes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chaines.html">
   Les chaînes de caractères
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dict.html">
   Les dictionnaires
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="fichiers.html">
   Interaction avec des fichiers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="api.html">
   Récupération de données à partir d’API web
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="test.html">
   Tester son code
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="conclusion.html">
   Conclusion
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Téléchargement
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/rtavenar/poly_python/raw/master/book.pdf">
   Version PDF
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/content/fichiers_latex.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/content/fichiers_latex.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download notebook file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        <a href="../_sources/content/fichiers_latex.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#manipulation-de-fichiers-en-python-avec-le-module-os">
   Manipulation de fichiers en Python avec le module
   <code class="docutils literal notranslate">
    <span class="pre">
     os
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lecture-et-ecriture-de-fichiers-textuels">
   Lecture et écriture de fichiers textuels
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#qu-est-ce-qu-un-fichier-textuel">
     Qu’est-ce qu’un fichier textuel ?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#encodage-des-fichiers">
     Encodage des fichiers
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#lecture-de-fichiers-textuels">
     Lecture de fichiers textuels
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#fichiers-textuels-generiques">
       Fichiers textuels génériques
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#fichiers-comma-separated-values-csv">
       Fichiers
       <em>
        Comma-Separated Values
       </em>
       (CSV)
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#cas-des-fichiers-a-en-tete">
         Cas des fichiers à en-tête
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#un-peu-de-magie">
         Un peu de magie…
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#fichiers-javascript-object-notation-json">
       Fichiers
       <em>
        JavaScript Object Notation
       </em>
       (JSON)
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ecriture-de-fichiers-textuels">
     Écriture de fichiers textuels
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       Fichiers textuels génériques
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#fichiers-csv">
       Fichiers CSV
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#fichiers-json">
       Fichiers JSON
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bonus-utilisation-de-with">
   Bonus : utilisation de
   <code class="docutils literal notranslate">
    <span class="pre">
     with
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercices">
   Exercices
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Interaction avec des fichiers</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#manipulation-de-fichiers-en-python-avec-le-module-os">
   Manipulation de fichiers en Python avec le module
   <code class="docutils literal notranslate">
    <span class="pre">
     os
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lecture-et-ecriture-de-fichiers-textuels">
   Lecture et écriture de fichiers textuels
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#qu-est-ce-qu-un-fichier-textuel">
     Qu’est-ce qu’un fichier textuel ?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#encodage-des-fichiers">
     Encodage des fichiers
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#lecture-de-fichiers-textuels">
     Lecture de fichiers textuels
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#fichiers-textuels-generiques">
       Fichiers textuels génériques
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#fichiers-comma-separated-values-csv">
       Fichiers
       <em>
        Comma-Separated Values
       </em>
       (CSV)
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#cas-des-fichiers-a-en-tete">
         Cas des fichiers à en-tête
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#un-peu-de-magie">
         Un peu de magie…
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#fichiers-javascript-object-notation-json">
       Fichiers
       <em>
        JavaScript Object Notation
       </em>
       (JSON)
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ecriture-de-fichiers-textuels">
     Écriture de fichiers textuels
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       Fichiers textuels génériques
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#fichiers-csv">
       Fichiers CSV
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#fichiers-json">
       Fichiers JSON
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bonus-utilisation-de-with">
   Bonus : utilisation de
   <code class="docutils literal notranslate">
    <span class="pre">
     with
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercices">
   Exercices
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="interaction-avec-des-fichiers">
<h1>Interaction avec des fichiers<a class="headerlink" href="#interaction-avec-des-fichiers" title="Permalink to this headline">#</a></h1>
<p>Dans ce chapitre, nous allons présenter des outils de manipulation de fichiers en Python.
Un fichier est une unité logique d’informations placée sur une mémoire secondaire (un disque dur, une clef USB, <em>etc.</em>).</p>
<p>Quand vous consultez une dossier à l’aide de votre gestionnaire de fichiers, ce dossier peut comprendre plusieurs fichiers.
En accédant depuis un programme Python au contenu de fichiers de données, on va pouvoir alimenter le programme avec des données provenant d’un fichier de données indépendant du programme (et non plus seulement des données écrites en dur dans le programmes ou saisies par l’utilisateur directement).</p>
<section id="manipulation-de-fichiers-en-python-avec-le-module-os">
<h2>Manipulation de fichiers en Python avec le module <code class="docutils literal notranslate"><span class="pre">os</span></code><a class="headerlink" href="#manipulation-de-fichiers-en-python-avec-le-module-os" title="Permalink to this headline">#</a></h2>
<p>Lorsque l’on lit ou écrit des fichiers, il est fréquent de vouloir répéter la même opération sur plusieurs fichiers, par exemple sur tous les fichiers avec l’extension <code class="docutils literal notranslate"><span class="pre">&quot;.txt&quot;</span></code> d’un répertoire donné.
Pour ce faire, on peut utiliser en Python le module <code class="docutils literal notranslate"><span class="pre">os</span></code> qui propose un certain nombre de fonctions standard de manipulation de fichiers.
On utilisera notamment la fonction <code class="docutils literal notranslate"><span class="pre">listdir</span></code> de ce module qui permet de lister l’ensemble des fichiers et sous-répertoires contenus dans un répertoire donné :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="k">for</span> <span class="n">nom_fichier</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s2">&quot;donnees&quot;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">nom_fichier</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>machin.csv
truc.txt
</pre></div>
</div>
</div>
</div>
<p>La fonction <code class="docutils literal notranslate"><span class="pre">listdir</span></code> peut prendre indifféremment un chemin absolu ou relatif (dans notre exemple, il s’agit d’un chemin relatif qui pointe sur le sous-répertoire <code class="docutils literal notranslate"><span class="pre">&quot;donnees&quot;</span></code> contenu dans le répertoire de travail courant du programme).</p>
<p>Si vous exécutez le code ci-dessus et que votre répertoire <code class="docutils literal notranslate"><span class="pre">&quot;donnees&quot;</span></code> n’est pas vide, vous remarquerez que le nom du fichier stocké dans la variable <code class="docutils literal notranslate"><span class="pre">nom_fichier</span></code> ne contient pas le chemin vers ce fichier.
Or, si l’on souhaite ensuite ouvrir ce fichier (que ce soit en lecture ou en écriture), il faudra bien spécifier ce chemin.
Pour cela, on utilisera la syntaxe suivante :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="n">repertoire</span> <span class="o">=</span> <span class="s2">&quot;donnees&quot;</span>
<span class="k">for</span> <span class="n">nom_fichier</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">repertoire</span><span class="p">):</span>
    <span class="n">nom_complet_fichier</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">repertoire</span><span class="p">,</span> <span class="n">nom_fichier</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">nom_fichier</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">nom_complet_fichier</span><span class="p">)</span>
    <span class="c1"># Ouverture et traitement du fichier dont le nom est contenu dans</span>
    <span class="c1"># nom_complet_fichier</span>
</pre></div>
</div>
<p>La fonction <code class="docutils literal notranslate"><span class="pre">path.join</span></code> du module <code class="docutils literal notranslate"><span class="pre">os</span></code> permet d’obtenir le chemin complet vers le fichier à partir du nom du répertoire dans lequel il se trouve et du nom du fichier isolé.
Il est préférable d’utiliser cette fonction plutôt que d’effectuer la concaténation des chaînes de caractères correspondantes car la forme des chemins complets dépend du système d’exploitation utilisé, ce que gère intelligemment <code class="docutils literal notranslate"><span class="pre">path.join</span></code>.</p>
</section>
<section id="lecture-et-ecriture-de-fichiers-textuels">
<h2>Lecture et écriture de fichiers textuels<a class="headerlink" href="#lecture-et-ecriture-de-fichiers-textuels" title="Permalink to this headline">#</a></h2>
<section id="qu-est-ce-qu-un-fichier-textuel">
<h3>Qu’est-ce qu’un fichier textuel ?<a class="headerlink" href="#qu-est-ce-qu-un-fichier-textuel" title="Permalink to this headline">#</a></h3>
<p>Dans ce qui suit, nous traiterons uniquement de la lecture de fichiers textuels.
Pour faire simple, nous appellerons dans ce qui suit “fichier textuel” tout fichier dont le contenu est lisible en clair en ouvrant le fichier avec un éditeur de fichiers bruts (comme Notepad++ sous windows, ou gedit sous linux).
Pour se faire une idée, nous pouvons (sous unix) utiliser la commande <code class="docutils literal notranslate"><span class="pre">head</span></code> qui permet d’afficher le début d’un fichier :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>head entete.csv
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>NOM;PRENOM;AGE
Lemarchand;John;23
Trias;Anne;
</pre></div>
</div>
</div>
</div>
<p>Et si l’on avait cherché à lire le contenu d’un fichier non textuel, on aurait obtenu des caractères spéciaux ne pouvant être interprétés comme du texte.</p>
<p>Dans ce chapitre, nous ne nous intéressons donc pas à ce dernier type de fichiers mais nous nous concentrerons sur la lecture/écriture de fichiers textuels par un programme Python.</p>
</section>
<section id="encodage-des-fichiers">
<h3>Encodage des fichiers<a class="headerlink" href="#encodage-des-fichiers" title="Permalink to this headline">#</a></h3>
<p>Un premier élément qu’il est nécessaire de maîtriser pour lire ou écrire des fichiers textuels est la notion d’encodage.
Il faut savoir qu’il existe plusieurs façons d’encoder un texte.
Nous nous focaliserons ici sur les deux encodages que vous êtes les plus susceptibles de rencontrer (mais sachez qu’il en existe bien d’autres) :</p>
<ul class="simple">
<li><p>l’encodage Unicode 8 bits (UTF-8), dont le code en python est <code class="docutils literal notranslate"><span class="pre">&quot;utf-8&quot;</span></code> ;</p></li>
<li><p>l’encodage Latin-1 (ISO-8859-1) dont le code en python est <code class="docutils literal notranslate"><span class="pre">&quot;iso-8859-1&quot;</span></code>.</p></li>
</ul>
<p>La principale différence entre ces deux encodage réside dans leur façon de coder les accents.
Ainsi, si le texte que vous lisez/écrivez ne contient aucun accent ou caractère spécial, il est probable que la question de l’encodage ne soit pas problématique dans votre cas.
Au contraire, s’il est possible que vous utilisiez de tels caractères, il faudra bien faire attention à l’encodage utilisé, que vous spécifierez à l’ouverture du fichier.
Si votre programme doit lire un fichier, il faudra donc vous assurer de l’encodage associé à ce fichier (en l’ouvrant par exemple avec un éditeur de texte qui soit suffisamment avancé pour vous fournir cette information).
Si vous écrivez un programme qui écrit un fichier, il faudra vous poser la question de l’utilisation future qui sera faite de ce fichier : s’il est amené à être ouvert par un autre utilisateur, il serait pertinent de vous demander quel encodage sera le moins problématique pour cet utilisateur, par exemple.</p>
<p>Si vous n’avez pas de contrainte extérieure pour ce qui est de l’encodage, vous utiliserez l’encodage UTF-8 par défaut.</p>
</section>
<section id="lecture-de-fichiers-textuels">
<h3>Lecture de fichiers textuels<a class="headerlink" href="#lecture-de-fichiers-textuels" title="Permalink to this headline">#</a></h3>
<p>Ce que nous appelons lecture de fichiers textuels en Python consiste à copier le contenu d’un fichier dans une (ou plusieurs) chaîne(s) de caractères.
Cela implique deux étapes en Python :</p>
<ol class="simple">
<li><p>ouvrir le fichier en lecture ;</p></li>
<li><p>parcourir le contenu du fichier.</p></li>
</ol>
<p>La première étape d’ouverture du fichier en lecture est commune à tous les types de fichiers textuels.
En supposant que le nom du fichier à ouvrir soit stocké sous forme de chaîne de caractères dans la variable <code class="docutils literal notranslate"><span class="pre">nom_fichier</span></code>, le code suivant ouvre un fichier en lecture avec l’encodage UTF-8 et stocke dans la variable <code class="docutils literal notranslate"><span class="pre">fp</span></code> un pointeur sur l’endroit où nous sommes rendus dans notre lecture du fichier (pour l’instant, le début du fichier) :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">nom_fichier</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Le second argument (<code class="docutils literal notranslate"><span class="pre">&quot;r&quot;</span></code>) indique que le fichier doit être ouvert en mode <em>read</em>, donc en lecture.</p>
<section id="fichiers-textuels-generiques">
<h4>Fichiers textuels génériques<a class="headerlink" href="#fichiers-textuels-generiques" title="Permalink to this headline">#</a></h4>
<p>Nous appelons ici “fichier textuel générique” un fichier dont le contenu n’a pas de structure particulière (par opposition aux fichiers CSV ou JSON présentés plus bas, par exemple).
C’est le cas par exemple de fichiers contenant du texte libre.
Ces fichiers, une fois ouverts en lecture, peuvent être lus ligne par ligne à l’aide de la boucle suivante :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">nom_fichier</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ligne</span> <span class="ow">in</span> <span class="n">fp</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ligne</span><span class="p">)</span>
</pre></div>
</div>
<p>Ici, la variable <code class="docutils literal notranslate"><span class="pre">ligne</span></code>, de type chaîne de caractères, contiendra successivement le texte de chacune des lignes du fichier considéré.</p>
</section>
<section id="fichiers-comma-separated-values-csv">
<h4>Fichiers <em>Comma-Separated Values</em> (CSV)<a class="headerlink" href="#fichiers-comma-separated-values-csv" title="Permalink to this headline">#</a></h4>
<p>Les fichiers <em>Comma-Separated Values</em> (CSV) permettent de stocker des données organisées sous la forme de tableaux dans des fichiers textuels.
À l’origine, ces fichiers étaient organisés par ligne et au sein de chaque ligne les cellules du tableau (correspondant aux différentes colonnes) étaient séparées par des virgules (d’où le nom de ce type de fichiers).
Aujourd’hui, la définition de ce format (<a class="reference external" href="https://tools.ietf.org/html/rfc4180">lien</a>) est plus générale que cela et différents délimiteurs sont acceptés.
Pour manipuler ces fichiers, il existe en Python un module dédié, appelé <code class="docutils literal notranslate"><span class="pre">csv</span></code>.
Ce module contient notamment une fonction <code class="docutils literal notranslate"><span class="pre">reader</span></code> permettant de simplifier la lecture de fichiers CSV.
La syntaxe d’utilisation de cette fonction est la suivante (vous remarquerez la présence de l’attribut <code class="docutils literal notranslate"><span class="pre">delimiter</span></code>) :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">csv</span>

<span class="n">nom_fichier</span> <span class="o">=</span> <span class="s2">&quot;simple.csv&quot;</span>

<span class="c1"># Contenu supposé du fichier :</span>
<span class="c1"># 1;2;3;4;5</span>
<span class="c1"># a;b;c;d;e</span>
<span class="c1"># xx;xx;xx;xx;xx</span>
<span class="c1"># 0.4;0.5;0.7;0.8;0.9</span>

<span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">nom_fichier</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ligne</span> <span class="ow">in</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">cellule</span> <span class="ow">in</span> <span class="n">ligne</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">cellule</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fin de ligne&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1
2
3
4
5
Fin de ligne
a
b
c
d
e
Fin de ligne
xx
xx
xx
xx
xx
Fin de ligne
0.4
0.5
0.7
0.8
0.9
Fin de ligne
</pre></div>
</div>
</div>
</div>
<p>On remarque ici que, contrairement au cas de fichiers textuels génériques, la variable de boucle <code class="docutils literal notranslate"><span class="pre">ligne</span></code> n’est plus une chaîne de caractères mais une liste de chaînes de caractères.
Les éléments de cette liste sont les cellules du tableau représenté par le fichier CSV.</p>
<section id="cas-des-fichiers-a-en-tete">
<h5>Cas des fichiers à en-tête<a class="headerlink" href="#cas-des-fichiers-a-en-tete" title="Permalink to this headline">#</a></h5>
<p>Souvent, les fichiers CSV comprennent une première ligne d’en-tête, comme dans l’exemple suivant :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NOM</span><span class="p">;</span><span class="n">PRENOM</span><span class="p">;</span><span class="n">AGE</span>
<span class="n">Lemarchand</span><span class="p">;</span><span class="n">John</span><span class="p">;</span><span class="mi">23</span>
<span class="n">Trias</span><span class="p">;</span><span class="n">Anne</span><span class="p">;</span>
</pre></div>
</div>
<p>Si l’on souhaite que, lors de la lecture du fichier CSV, chaque ligne soit représentée par un dictionnaire dont les clés sont les noms de colonnes (lus dans l’en-tête) et les valeurs associées sont celles lues dans la ligne courante, on utilisera <code class="docutils literal notranslate"><span class="pre">csv.DictReader</span></code> au lieu de <code class="docutils literal notranslate"><span class="pre">csv.reader</span></code> :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">csv</span>

<span class="n">nom_fichier</span> <span class="o">=</span> <span class="s2">&quot;entete.csv&quot;</span>

<span class="c1"># Contenu supposé du fichier :</span>
<span class="c1"># NOM;PRENOM;AGE</span>
<span class="c1"># Lemarchand;John;23</span>
<span class="c1"># Trias;Anne;</span>

<span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">nom_fichier</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ligne</span> <span class="ow">in</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">cle</span><span class="p">,</span> <span class="n">valeur</span> <span class="ow">in</span> <span class="n">ligne</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">cle</span><span class="p">,</span> <span class="n">valeur</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--Fin de ligne--&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>NOM Lemarchand
PRENOM John
AGE 23
--Fin de ligne--
NOM Trias
PRENOM Anne
AGE 
--Fin de ligne--
</pre></div>
</div>
</div>
</div>
</section>
<section id="un-peu-de-magie">
<h5>Un peu de magie…<a class="headerlink" href="#un-peu-de-magie" title="Permalink to this headline">#</a></h5>
<p>Dans certains cas, on ne sait pas à l’avance quel délimiteur est utilisé pour le fichier CSV à lire. On peut demander au module CSV de deviner le <em>dialecte</em><a class="footnote-reference brackets" href="#dialect" id="id1">1</a> d’un fichier en lisant le début de ce fichier.
Dans ce cas, la lecture du fichier se fera en 4 étapes :</p>
<ol class="simple">
<li><p>Ouverture du fichier en lecture ;</p></li>
<li><p>Lecture des <em>n</em> premiers caractères du fichier pour tenter de deviner son dialecte ;</p></li>
<li><p>“Rembobinage” du fichier pour recommencer la lecture au début ;</p></li>
<li><p>Lecture du fichier en utilisant le dialecte détecté à l’étape 2.</p></li>
</ol>
<p>Le choix du paramètre <em>n</em> doit être un compromis : il faut lire suffisamment de caractères pour que la détection de dialecte soit fiable, tout en sachant que lire beaucoup de caractères prendra du temps.
En pratique, lire les 1000 premiers caractères d’un fichier est souvent suffisant pour déterminer son dialecte.</p>
<p>On obtient alors une syntaxe du type :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">csv</span>

<span class="n">nom_fichier</span> <span class="o">=</span> <span class="s2">&quot;simple.csv&quot;</span>

<span class="c1"># Contenu supposé du fichier :</span>
<span class="c1"># 1,2,3</span>
<span class="c1"># a,b</span>

<span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">nom_fichier</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>  <span class="c1"># Étape 1.</span>
<span class="n">dialecte</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">Sniffer</span><span class="p">()</span><span class="o">.</span><span class="n">sniff</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>  <span class="c1"># Étape 2.</span>
<span class="n">fp</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>                                     <span class="c1"># Étape 3. À ne pas oublier !</span>
<span class="k">for</span> <span class="n">ligne</span> <span class="ow">in</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">dialect</span><span class="o">=</span><span class="n">dialecte</span><span class="p">):</span> <span class="c1"># Étape 4.</span>
    <span class="k">for</span> <span class="n">cellule</span> <span class="ow">in</span> <span class="n">ligne</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">cellule</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fin de ligne&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1
2
3
4
5
Fin de ligne
a
b
c
d
e
Fin de ligne
xx
xx
xx
xx
xx
Fin de ligne
0.4
0.5
0.7
0.8
0.9
Fin de ligne
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="fichiers-javascript-object-notation-json">
<h4>Fichiers <em>JavaScript Object Notation</em> (JSON)<a class="headerlink" href="#fichiers-javascript-object-notation-json" title="Permalink to this headline">#</a></h4>
<p>Les fichiers <em>JavaScript Object Notation</em> (JSON) permettent de stocker des données structurées (par exemple avec une organisation hiérarchique). Un document JSON s’apparente à un dictionnaire en Python (à la nuance près que les clés d’un document JSON sont forcément des chaînes de caractères).
Voici un exemple de document JSON :</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;num_etudiant&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;21300000&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;notes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">],</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;date_de_naissance&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;jour&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;mois&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;annee&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1995</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>En Python, pour lire de tels fichiers, on dispose du module <code class="docutils literal notranslate"><span class="pre">json</span></code> qui contient une fonction <code class="docutils literal notranslate"><span class="pre">load</span></code> :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>

<span class="n">nom_fichier</span> <span class="o">=</span> <span class="s2">&quot;simple.json&quot;</span>

<span class="c1"># Contenu supposé du fichier :</span>
<span class="c1"># {</span>
<span class="c1">#    &quot;num_etudiant&quot;: &quot;21300000&quot;,</span>
<span class="c1">#    &quot;notes&quot;: [12, 5, 14],</span>
<span class="c1">#    &quot;date_de_naissance&quot;: {</span>
<span class="c1">#        &quot;jour&quot;: 1,</span>
<span class="c1">#        &quot;mois&quot;: 1,</span>
<span class="c1">#        &quot;annee&quot;: 1995</span>
<span class="c1">#    }</span>
<span class="c1"># }</span>

<span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">nom_fichier</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;num_etudiant&#39;: &#39;21300000&#39;, &#39;notes&#39;: [12, 5, 14], &#39;date_de_naissance&#39;: {&#39;jour&#39;: 1, &#39;mois&#39;: 1, &#39;annee&#39;: 1995}}
</pre></div>
</div>
</div>
</div>
<p>Il est à noter qu’un fichier JSON peut également contenir une liste de dictionnaires, comme dans l’exemple suivant :</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;num_etudiant&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;21300000&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;notes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">],</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;date_de_naissance&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;jour&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;mois&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;annee&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1995</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">},</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;num_etudiant&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;21300001&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;notes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">14</span><span class="p">],</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;date_de_naissance&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;jour&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;mois&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;annee&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1989</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}]</span><span class="w"></span>
</pre></div>
</div>
<p>Dans ce cas, <code class="docutils literal notranslate"><span class="pre">json.load</span></code> retournera une liste de dictionnaires au lieu d’un dictionnaire, bien évidemment.</p>
<p>Enfin, si l’on a stocké dans une variable une chaîne de caractères dont le contenu correspond à un document JSON, on peut également la transformer en dictionnaire (ou en liste de dictionnaires) à l’aide de la fonction <code class="docutils literal notranslate"><span class="pre">json.loads</span></code> (attention au “s” final) :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ch</span> <span class="o">=</span> <span class="s1">&#39;{&quot;num_etudiant&quot;: &quot;21300000&quot;,  &quot;notes&quot;: [12, 5, 14]}&#39;</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>  <span class="c1"># loads : load (from) string</span>
<span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;num_etudiant&#39;: &#39;21300000&#39;, &#39;notes&#39;: [12, 5, 14]}
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="ecriture-de-fichiers-textuels">
<h3>Écriture de fichiers textuels<a class="headerlink" href="#ecriture-de-fichiers-textuels" title="Permalink to this headline">#</a></h3>
<p>Ce que nous appellons écriture de fichiers textuels en Python consiste à copier le contenu d’une (ou plusieurs) chaîne(s) de caractères dans un fichier.
Cela implique trois étapes en Python :</p>
<ol class="simple">
<li><p>ouvrir le fichier en écriture ;</p></li>
<li><p>ajouter du contenu dans le fichier ;</p></li>
<li><p>fermer le fichier.</p></li>
</ol>
<p>La première étape d’ouverture du fichier en écriture est commune à tous les types de fichiers textuels.
En supposant que le nom du fichier à ouvrir est stocké sous forme de chaîne de caractères dans la variable <code class="docutils literal notranslate"><span class="pre">nom_fichier</span></code>, le code suivant ouvre un fichier en écriture avec l’encodage UTF-8 et stocke dans la variable <code class="docutils literal notranslate"><span class="pre">fp</span></code> un pointeur sur l’endroit où nous sommes rendus dans notre écriture du fichier (pour l’instant, le début du fichier) :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">nom_fichier</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Le second argument (<code class="docutils literal notranslate"><span class="pre">&quot;w&quot;</span></code>) indique que le fichier doit être ouvert en mode <em>write</em>, donc en écriture.</p>
<p>Si le fichier en question existait déjà, son contenu est tout d’abord écrasé et on repart d’un fichier vide.
Si l’on souhaite au contraire ajouter du texte à la fin d’un fichier existant, on utilisera le mode <em>append</em>, symbolisé par la lettre <code class="docutils literal notranslate"><span class="pre">&quot;a&quot;</span></code> :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">nom_fichier</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Une fois les instructions d’écriture exécutées (voir plus bas), on doit fermer le fichier pour s’assurer que l’écriture sera effective :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Il est à noter que l’on peut, dans certains cas, se dispenser de fermer explicitement le fichier.
Par exemple, si notre code est inclus dans un script Python, dès la fin de l’exécution du script, tous les fichiers ouverts en écriture par le script sont automatiquement fermés.</p>
<section id="id2">
<h4>Fichiers textuels génériques<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h4>
<p>Pour ajouter du contenu à un fichier pointé par la variable <code class="docutils literal notranslate"><span class="pre">fp</span></code>, il suffit ensuite d’utiliser la méthode <code class="docutils literal notranslate"><span class="pre">write</span></code> :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;La vie est belle</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Notez que, contrairement à la fonction <code class="docutils literal notranslate"><span class="pre">print</span></code> à laquelle vous êtes habitué, la méthode <code class="docutils literal notranslate"><span class="pre">write</span></code> ne rajoute pas de caractère de fin de ligne après la chaîne de caractères passée en argument, il faut donc inclure ce caractère <code class="docutils literal notranslate"><span class="pre">&quot;\n&quot;</span></code> à la fin de la chaîne de caractères passée en argument, si vous souhaitez inclure un retour à la ligne.</p>
</section>
<section id="fichiers-csv">
<h4>Fichiers CSV<a class="headerlink" href="#fichiers-csv" title="Permalink to this headline">#</a></h4>
<p>Le module <code class="docutils literal notranslate"><span class="pre">csv</span></code> déjà cité plus haut contient également une fonction <code class="docutils literal notranslate"><span class="pre">writer</span></code> permettant de simplifier l’écriture de fichiers CSV.
La syntaxe d’utilisation de cette fonction est la suivante :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">csv</span>

<span class="n">nom_fichier</span> <span class="o">=</span> <span class="s2">&quot;ecriture.csv&quot;</span>

<span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">nom_fichier</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">csvfp</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
<span class="n">csvfp</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>
<span class="n">csvfp</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="c1"># Après cela, le fichier contiendra les lignes suivantes :</span>
<span class="c1"># 1;5;7</span>
<span class="c1"># 2;3</span>
</pre></div>
</div>
</div>
</div>
<p>La méthode <code class="docutils literal notranslate"><span class="pre">writerow</span></code> prend donc une liste en argument et écrit dans le fichier les éléments de cette liste, séparés par le délimiteur <code class="docutils literal notranslate"><span class="pre">&quot;;&quot;</span></code> spécifié lors de l’appel à la fonction <code class="docutils literal notranslate"><span class="pre">writer</span></code>.
Le retour à la ligne est écrit directement par la méthode <code class="docutils literal notranslate"><span class="pre">writerow</span></code>, vous n’avez pas à vous en occuper.</p>
</section>
<section id="fichiers-json">
<h4>Fichiers JSON<a class="headerlink" href="#fichiers-json" title="Permalink to this headline">#</a></h4>
<p>Le module <code class="docutils literal notranslate"><span class="pre">json</span></code> déjà cité plus haut contient également une fonction <code class="docutils literal notranslate"><span class="pre">dump</span></code> permettant d’écrire le contenu d’un dictionnaire (ou d’une liste de dictionnaires) dans un fichier JSON.
La syntaxe d’utilisation de cette fonction est la suivante :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>

<span class="n">nom_fichier</span> <span class="o">=</span> <span class="s2">&quot;ecriture.json&quot;</span>

<span class="n">liste</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">nom_fichier</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">liste</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
<span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="c1"># Après cela, le fichier contiendra la ligne suivante :</span>
<span class="c1"># [{&quot;a&quot;: 5}, {&quot;b&quot;: 3, &quot;a&quot;: 7}]</span>
</pre></div>
</div>
</div>
</div>
<p>Vous pouvez vous référer à <a class="reference external" href="https://docs.python.org/fr/3/library/json.html#basic-usage">la documentation de cette fonction</a> pour maîtriser plus finement la mise en forme du contenu du fichier de sortie.</p>
</section>
</section>
</section>
<section id="bonus-utilisation-de-with">
<h2>Bonus : utilisation de <code class="docutils literal notranslate"><span class="pre">with</span></code><a class="headerlink" href="#bonus-utilisation-de-with" title="Permalink to this headline">#</a></h2>
<p>Il existe en Python un moyen très efficace de maîtriser la durée de vie d’une variable : il s’agit de la directive <code class="docutils literal notranslate"><span class="pre">with</span></code>, dont la syntaxe est la suivante :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">EXPRESSION</span> <span class="k">as</span> <span class="n">VARIABLE</span><span class="p">:</span>
    <span class="n">BLOC_DE_CODE</span>
</pre></div>
</div>
<p>Le code ci-dessus signifie que l’on va créer une variable <code class="docutils literal notranslate"><span class="pre">VARIABLE</span></code> qui va stocker la valeur de retour de <code class="docutils literal notranslate"><span class="pre">EXPRESSION</span></code> (<a class="reference external" href="https://docs.python.org/2.5/whatsnew/pep-343.html">ceci n’est pas tout à fait exact</a>, mais dans l’exemple qui nous intéresse, cela revient au même), puis le code situé dans <code class="docutils literal notranslate"><span class="pre">BLOC_DE_CODE</span></code> sera exécuté et, à la fin de ce bloc de code, <code class="docutils literal notranslate"><span class="pre">VARIABLE</span></code> sera détruite.</p>
<p>Cette syntaxe peut s’avérer fort utile lorsque l’on manipule des fichiers, parce que les pointeurs de fichiers, lorsqu’ils sont détruits, ferment automatiquement le fichier en question, et il n’est donc pas nécessaire de faire appel à la méthode <code class="docutils literal notranslate"><span class="pre">.close()</span></code> explicitement.</p>
<p>On pourra donc écrire :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;simple.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">texte</span> <span class="ow">in</span> <span class="n">fp</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">texte</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1;2;3;4;5

a;b;c;d;e

xx;xx;xx;xx;xx

0.4;0.5;0.7;0.8;0.9
</pre></div>
</div>
</div>
</div>
<p>et le fichier sera tout de même fermé correctement dès que l’on sortira du bloc <code class="docutils literal notranslate"><span class="pre">with</span></code>.</p>
</section>
<section id="exercices">
<h2>Exercices<a class="headerlink" href="#exercices" title="Permalink to this headline">#</a></h2>
<div class="admonition-exercice-7-1 admonition">
<p class="admonition-title">Exercice 7.1</p>
<p>Écrivez une fonction qui affiche, pour chaque fichier d’extension <code class="docutils literal notranslate"><span class="pre">&quot;.txt&quot;</span></code> d’un répertoire passé en argument, le nom du fichier ainsi que son nombre de lignes.</p>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">nb_lignes</span><span class="p">(</span><span class="n">nom_fichier</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">nom_fichier</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ligne</span> <span class="ow">in</span> <span class="n">fp</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">n</span>

<span class="k">def</span> <span class="nf">nb_lignes_repertoire</span><span class="p">(</span><span class="n">repertoire</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">nom_fichier</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">repertoire</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">nom_fichier</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.txt&quot;</span><span class="p">):</span>
            <span class="n">nom_complet_fichier</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">repertoire</span><span class="p">,</span> <span class="n">nom_fichier</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">nb_lignes</span><span class="p">(</span><span class="n">nom_complet_fichier</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">nom_complet_fichier</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

<span class="n">nb_lignes_repertoire</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition-exercice-7-2 admonition">
<p class="admonition-title">Exercice 7.2</p>
<p>Écrivez une fonction qui retourne le nombre de fichiers présents dans un répertoire dont le nom est passé en argument.
Vous pourrez vous aider pour cela de la documentation du sous-module <code class="docutils literal notranslate"><span class="pre">path</span></code> du module <code class="docutils literal notranslate"><span class="pre">os</span></code> (<a class="reference external" href="https://docs.python.org/3.5/library/os.path.html">lien</a>).</p>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">compte_fichiers</span><span class="p">(</span><span class="n">repertoire</span><span class="p">):</span>
    <span class="n">compteur</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">repertoire</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">repertoire</span><span class="p">,</span> <span class="n">f</span><span class="p">)):</span>
            <span class="n">compteur</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">compteur</span>

<span class="nb">print</span><span class="p">(</span><span class="n">compte_fichiers</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<hr class="footnotes docutils" />
<dl class="footnote brackets">
<dt class="label" id="dialect"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Le <em>dialecte</em> d’un fichier CSV définit, en fait, bien plus que le caractère de séparation des cellules, comme décrit dans <a class="reference external" href="https://tools.ietf.org/html/rfc4180">ce document</a>.</p>
</dd>
</dl>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./content"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Romain Tavenard<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>