

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Récupération de données à partir d’API web &#8212; Introduction à Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/betterpythonpad.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/vue.js"></script>
    <script src="../_static/pythonpad.bundle.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/api';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="numpy et le calcul matriciel" href="numpy.html" />
    <link rel="prev" title="Interaction avec des fichiers" href="fichiers.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo_ur2.svg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo_ur2.svg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Contenu du livre</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="struct.html">Structures de données et structures de contrôle</a></li>
<li class="toctree-l1"><a class="reference internal" href="dates.html">Les dates</a></li>
<li class="toctree-l1"><a class="reference internal" href="listes.html">Les listes</a></li>
<li class="toctree-l1"><a class="reference internal" href="chaines.html">Les chaînes de caractères</a></li>
<li class="toctree-l1"><a class="reference internal" href="dict.html">Les dictionnaires</a></li>
<li class="toctree-l1"><a class="reference internal" href="sets_tuples.html">Les <em>sets</em> et les <em>tuples</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="fichiers.html">Interaction avec des fichiers</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Récupération de données à partir d’API web</a></li>
<li class="toctree-l1"><a class="reference internal" href="numpy.html"><code class="docutils literal notranslate"><span class="pre">numpy</span></code> et le calcul matriciel</a></li>
<li class="toctree-l1"><a class="reference internal" href="poo.html">La Programmation Orientée Objet</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html">Tester son code</a></li>
<li class="toctree-l1"><a class="reference internal" href="conclusion.html">Conclusion</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Téléchargement</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://github.com/rtavenar/poly_python/raw/master/book.pdf">Version PDF</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/content/api.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Récupération de données à partir d’API web</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requetes-http-en-python">Requêtes HTTP en Python</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#format-d-une-requete-http">Format d’une requête HTTP</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#utilisation-du-module-requests">Utilisation du module <code class="docutils literal notranslate"><span class="pre">requests</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercice">Exercice</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="recuperation-de-donnees-a-partir-d-api-web">
<h1>Récupération de données à partir d’API web<a class="headerlink" href="#recuperation-de-donnees-a-partir-d-api-web" title="Permalink to this heading">#</a></h1>
<p>De nombreux services web fournissent des API (<em>Application Programming Interface</em>) pour mettre des données à disposition du grand public. Le principe de fonctionnement de ces API est le suivant : l’utilisateur effectue une requête sous la forme d’une requête HTTP, le service web met en forme les données correspondant à la requête et les renvoie à l’utilisateur, dans un format défini à l’avance.</p>
<p>Voici une liste (très loin d’être exhaustive) d’API web d’accès aux données :</p>
<ul class="simple">
<li><p>Google Maps</p>
<ul>
<li><p>Directions API : permet de calculer des itinéraires ;</p></li>
<li><p>Elevation API : permet de calculer l’altitude d’un point sur le globe terrestre ;</p></li>
<li><p>Distance Matrix API : permet de calculer des distances entre points du globe ;</p></li>
<li><p>Geocoding API : permet d’associer une coordonnée GPS à une adresse.</p></li>
</ul>
</li>
<li><p>Twitter</p>
<ul>
<li><p>Twitter API : permet de récupérer des informations sur les utilisateurs du réseau et leurs <em>tweets</em>.</p></li>
</ul>
</li>
<li><p>Facebook</p>
<ul>
<li><p>Facebook Graph API : permet de récupérer des informations sur des utilisateurs Facebook .</p></li>
</ul>
</li>
<li><p>STAR (Transports en commun rennais)</p>
<ul>
<li><p>Horaires des bus ;</p></li>
<li><p>Disponibilité des vélos dans les relais VéloStar.</p></li>
</ul>
</li>
</ul>
<p>Pour manipuler en Python de telles données, il faudra donc être capable :</p>
<ol class="arabic simple">
<li><p>d’envoyer une requête HTTP et de récupérer le résultat ;</p></li>
<li><p>de transformer le résultat en une variable Python facilement manipulable.</p></li>
</ol>
<p>Pour ce qui est du second point, la plupart des API web offrent la possibilité de récupérer les données au format JSON.
Nous avons vu précédemment dans ce cours que ce format était facilement manipulable en Python, notamment parce qu’il est très proche de la notion de dictionnaire.
Ce chapitre se focalise donc sur la réalisation de requêtes HTTP en Python.</p>
<section id="requetes-http-en-python">
<h2>Requêtes HTTP en Python<a class="headerlink" href="#requetes-http-en-python" title="Permalink to this heading">#</a></h2>
<section id="format-d-une-requete-http">
<h3>Format d’une requête HTTP<a class="headerlink" href="#format-d-une-requete-http" title="Permalink to this heading">#</a></h3>
<p>Dans un premier temps, étudions le format d’une requête HTTP, telle que vous en effectuez des dizaines chaque jour, par l’intermédiaire de votre navigateur web.
Lorsque vous entrez dans la barre d’adresse de votre navigateur l’URL suivante :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://people.irisa.fr/Romain.Tavenard/index.php?page=3
</pre></div>
</div>
<p>votre navigateur va envoyer une requête au serveur concerné (cette requête ne contiendra pas uniquement l’URL visée mais aussi d’autres informations sur lesquelles nous ne nous attarderons pas ici).
Dans l’URL précédente, on distingue 4 sous parties :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">http://</span></code> indique le protocole à utiliser pour effectuer la requête (ici HTTP). Dans ce chapitre, nous ne nous intéresserons qu’aux protocoles HTTP et HTTPS (version sécurisée du protocole HTTP) ;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">people.irisa.fr</span></code> est le nom de domaine du serveur (<em>ie.</em> de la machine) à contacter pour obtenir une réponse ;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/Romain.Tavenard/index.php</span></code> indique le chemin du fichier à récupérer sur cette machine ;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">?page=3</span></code> indique que l’on doit passer la valeur <code class="docutils literal notranslate"><span class="pre">3</span></code> au paramètre <code class="docutils literal notranslate"><span class="pre">page</span></code> lors de la requête.</p></li>
</ul>
<p>De la même façon, lors d’un appel à une API web, on spécifiera le protocole à utiliser, la machine à contacter, le chemin vers la ressource voulue et un certain nombre de paramètres qui décriront notre requête.
Voici un exemple de requête à une API web (l’API Google Maps Directions en l’occurrence) :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>https://maps.googleapis.com/maps/api/directions/json?origin=Toronto&amp;destination=Montreal
</pre></div>
</div>
<p>Vous pouvez copier/coller cette URL dans la barre d’adresse de votre navigateur et observer ce que vous obtenez en retour.
Observez que le résultat de cette requête est au format JSON.
En fait, si vous étudiez plus précisément l’URL fournie, vous verrez que c’est nous qui avons demandé à obtenir le résultat dans ce format.
De plus, on a spécifié dans l’URL que l’on souhaitait obtenir les informations d’itinéraire pour aller de Toronto (paramètre <code class="docutils literal notranslate"><span class="pre">origin</span></code>) à Montreal (paramètre <code class="docutils literal notranslate"><span class="pre">destination</span></code>).</p>
<p>Vous devez aussi remarquer que, en réponse à cette requête, l’API Google Maps renvoie en fait un message d’erreur.
En effet, pour être autorisé à utiliser cette API, il faut disposer d’une clé d’API et renseigner cette clé sous la forme d’un paramètre supplémentaire (nommé <code class="docutils literal notranslate"><span class="pre">key</span></code> dans les API Google Maps par exemple).
Ainsi, la requête précédente deviendrait :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>https://maps.googleapis.com/maps/api/directions/json?origin=Toronto&amp;destination=Montreal&amp;key=VOTRE_CLE
</pre></div>
</div>
<p>dans laquelle vous devrez remplacer <code class="docutils literal notranslate"><span class="pre">VOTRE_CLE</span></code> par une clé que vous aurez préalablement générée et qui vous permettra d’utiliser le service web de manière authentifiée.
Pour créer une clef d’API, il faut se rendre sur l’interface développeur de l’API concernée (<a class="reference external" href="https://developers.google.com/maps/documentation/directions/start?hl=fr">ici</a> pour l’API <em>Google Maps Directions</em> par exemple).</p>
</section>
<section id="utilisation-du-module-requests">
<h3>Utilisation du module <code class="docutils literal notranslate"><span class="pre">requests</span></code><a class="headerlink" href="#utilisation-du-module-requests" title="Permalink to this heading">#</a></h3>
<div class="tip admonition">
<p class="admonition-title">Les requêtes HTTP en (très) bref</p>
<p>Dans le protocole HTTP, il existe plusieurs types de requêtes pour réaliser l’échange entre le client et le serveur.
En particulier les requêtes de type GET sont très utilisées lorsque le client demande une ressource au serveur.
Il s’agit d’une requête de téléchargement d’un document.
Il est possible de transmettre des paramètres pour filtrer la réponse ; dans ce cas, les paramètres seront transférés “en clair” (dans l’URL utilisée pour la requête).</p>
<p>Les requêtes de type POST permettent comme GET de télécharger un document du serveur vers le client mais avec un plus de sophistication : les paramètres sont masqués et il est possible de demander de mettre à jour des données sur le serveur à l’occasion de la requête.</p>
<p>Il existe d’autres requêtes HTTP que nous ne détaillons pas ici.</p>
</div>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<div class="tip admonition">
<p class="admonition-title">Installer un paquet Python</p>
<p>Le module <code class="docutils literal notranslate"><span class="pre">requests</span></code> ne fait pas partie de la librairie standard en Python.
Il faut donc l’installer avant de pouvoir l’utiliser.
Pour ce faire, on peut utiliser le gestionnaire de paquets <code class="docutils literal notranslate"><span class="pre">pip</span></code>.</p>
<p>Si vous utilisez Anaconda, la documentation en ligne disponible à <a class="reference external" href="https://docs.anaconda.com/anaconda/navigator/tutorials/manage-packages/">cette adresse</a> explique la marche à suivre pour installer de nouveaux paquets dans votre version de Python fournie par Anaconda.
Si vous utilisez plutôt l’IDE PyCharm et une version de Python non fournie par Anaconda, vous pourrez trouver de la documentation <a class="reference external" href="https://www.jetbrains.com/help/pycharm/installing-uninstalling-and-upgrading-packages.html">à cette adresse</a>.</p>
</div>
</aside>
<p>La section précédente proposait un rappel sur le format des requêtes HTTP et vous avez été invités à effectuer des requêtes HTTP à l’aide de votre navigateur.
Si maintenant on souhaite récupérer de manière automatique le résultat d’une requête HTTP pour le manipuler en Python, le plus commode est d’effectuer la requête HTTP depuis Python.
Pour cela, on utilise le module <code class="docutils literal notranslate"><span class="pre">requests</span></code>.
Ce module contient notamment une fonction <code class="docutils literal notranslate"><span class="pre">get</span></code> qui permet d’effectuer des requêtes HTTP de type GET (je vous laisse deviner le nom de la fonction qui permet d’effectuer des requêtes HTTP POST :) :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://my-json-server.typicode.com/rtavenar/fake_api/tasks&quot;</span>

<span class="n">reponse</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">reponse</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Response [200]&gt;
</pre></div>
</div>
</div>
</div>
<p>On voit ici que l’on a reçu une réponse de code 200, ce qui signifie que la requête s’est déroulée correctement.</p>
<div class="tip dropdown admonition">
<p class="admonition-title">Codes de retour HTTP</p>
<p>Voici quelques codes de retour de requêtes HTTP qui peuvent vous être utiles :</p>
<ul class="simple">
<li><p>20x : la transaction s’est bien déroulée</p>
<ul>
<li><p><em>ex.</em> 200 : la requête s’est effectuée correctement</p></li>
</ul>
</li>
<li><p>40x : erreur “due au client”</p>
<ul>
<li><p><em>ex.</em> 404 : page non trouvée</p></li>
</ul>
</li>
<li><p>50x : erreur “due au serveur”</p>
<ul>
<li><p><em>ex.</em> 504 : Temps imparti écoulé</p></li>
</ul>
</li>
</ul>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">contenu_txt</span> <span class="o">=</span> <span class="n">reponse</span><span class="o">.</span><span class="n">text</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">contenu_txt</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;str&#39;&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">contenu</span> <span class="o">=</span> <span class="n">reponse</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">contenu</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;list&#39;&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">contenu</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;userId&#39;: 1, &#39;id&#39;: 1, &#39;title&#39;: &#39;delectus aut autem&#39;, &#39;completed&#39;: False}, {&#39;userId&#39;: 1, &#39;id&#39;: 2, &#39;title&#39;: &#39;quis ut nam facilis et officia qui&#39;, &#39;completed&#39;: False}, {&#39;userId&#39;: 1, &#39;id&#39;: 3, &#39;title&#39;: &#39;fugiat veniam minus&#39;, &#39;completed&#39;: False}, {&#39;userId&#39;: 1, &#39;id&#39;: 4, &#39;title&#39;: &#39;et porro tempora&#39;, &#39;completed&#39;: True}, {&#39;userId&#39;: 1, &#39;id&#39;: 8, &#39;title&#39;: &#39;quo adipisci enim quam ut ab&#39;, &#39;completed&#39;: True}, {&#39;userId&#39;: 3, &#39;id&#39;: 44, &#39;title&#39;: &#39;cum debitis quis accusamus doloremque ipsa natus sapiente omnis&#39;, &#39;completed&#39;: True}, {&#39;userId&#39;: 3, &#39;id&#39;: 45, &#39;title&#39;: &#39;velit soluta adipisci molestias reiciendis harum&#39;, &#39;completed&#39;: False}, {&#39;userId&#39;: 3, &#39;id&#39;: 46, &#39;title&#39;: &#39;vel voluptatem repellat nihil placeat corporis&#39;, &#39;completed&#39;: False}]
</pre></div>
</div>
</div>
</div>
<p>On voit ici qu’il est possible d’obtenir le résultat de notre requête sous deux formes : le texte brut du résultat qui est stocké dans <code class="docutils literal notranslate"><span class="pre">reponse.text</span></code> et la version mise en forme (sous la forme de dictionnaire ou de liste) de ce résultat que l’on obtient via <code class="docutils literal notranslate"><span class="pre">reponse.json()</span></code>.</p>
<p>De plus, si l’on souhaite passer des paramètres à la requête HTTP (ce qui se trouvait après le symbole <code class="docutils literal notranslate"><span class="pre">?</span></code> dans les URL ci-dessus), il est possible de le faire lors de l’appel à <code class="docutils literal notranslate"><span class="pre">requests.get</span></code> :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://my-json-server.typicode.com/rtavenar/fake_api/tasks&quot;</span>

<span class="n">reponse</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="s2">&quot;userId=3&quot;</span><span class="p">)</span>
<span class="n">contenu</span> <span class="o">=</span> <span class="n">reponse</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">contenu</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;userId&#39;: 3, &#39;id&#39;: 44, &#39;title&#39;: &#39;cum debitis quis accusamus doloremque ipsa natus sapiente omnis&#39;, &#39;completed&#39;: True}, {&#39;userId&#39;: 3, &#39;id&#39;: 45, &#39;title&#39;: &#39;velit soluta adipisci molestias reiciendis harum&#39;, &#39;completed&#39;: False}, {&#39;userId&#39;: 3, &#39;id&#39;: 46, &#39;title&#39;: &#39;vel voluptatem repellat nihil placeat corporis&#39;, &#39;completed&#39;: False}]
</pre></div>
</div>
</div>
</div>
<p>Le code ci-dessus correspond ainsi à ce que vous obtiendriez dans votre navigateur en entrant l’URL <a class="reference external" href="http://my-json-server.typicode.com/rtavenar/fake_api/tasks?userId=3">http://my-json-server.typicode.com/rtavenar/fake_api/tasks?userId=3</a>.</p>
<p>En pratique, dans de nombreux cas, des modules Python existent pour permettre d’utiliser les API grand public sans avoir à gérer les requêtes HTTP directement.
C’est par exemple le cas des modules <a class="reference external" href="http://docs.tweepy.org/en/latest/"><code class="docutils literal notranslate"><span class="pre">tweepy</span></code></a> (pour l’API Twitter) ou <a class="reference external" href="https://graphh.readthedocs.io/en/latest/"><code class="docutils literal notranslate"><span class="pre">graphh</span></code></a> (qui permet d’accéder à l’API GraphHopper qui est un équivalent libre de Google Maps)<a class="footnote-reference brackets" href="#graphh" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.</p>
</section>
</section>
<section id="exercice">
<h2>Exercice<a class="headerlink" href="#exercice" title="Permalink to this heading">#</a></h2>
<div class="admonition-exercice-9-1 admonition">
<p class="admonition-title"><strong>Exercice 9.1</strong></p>
<p>Écrivez une fonction qui prenne en entrée une liste de <code class="docutils literal notranslate"><span class="pre">userId</span></code> et affiche l’ensemble des entrées de l’API <a class="reference external" href="http://my-json-server.typicode.com/rtavenar/fake_api/tasks">http://my-json-server.typicode.com/rtavenar/fake_api/tasks</a> pour lesquelles l’attribut <code class="docutils literal notranslate"><span class="pre">completed</span></code> vaut <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<ul class="simple">
<li><p>Solution 1</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>

<span class="k">def</span> <span class="nf">affiche_api</span><span class="p">(</span><span class="n">liste_userId</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://my-json-server.typicode.com/rtavenar/fake_api/tasks&quot;</span>
    <span class="n">contenu</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">list_taches</span> <span class="o">=</span> <span class="n">contenu</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">tache</span> <span class="ow">in</span> <span class="n">list_taches</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tache</span><span class="p">[</span><span class="s2">&quot;completed&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">tache</span><span class="p">[</span><span class="s2">&quot;userId&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">liste_userId</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">tache</span><span class="p">)</span>

<span class="n">affiche_api</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Solution 2 : en utilisant les paramètres d’URL</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>

<span class="k">def</span> <span class="nf">affiche_api</span><span class="p">(</span><span class="n">liste_userId</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://my-json-server.typicode.com/rtavenar/fake_api/tasks&quot;</span>
    <span class="n">contenu</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="s2">&quot;completed=true&quot;</span><span class="p">)</span>
    <span class="n">list_taches</span> <span class="o">=</span> <span class="n">contenu</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">tache</span> <span class="ow">in</span> <span class="n">list_taches</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tache</span><span class="p">[</span><span class="s2">&quot;userId&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">liste_userId</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">tache</span><span class="p">)</span>

<span class="n">affiche_api</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<hr class="footnotes docutils" />
<aside class="footnote brackets" id="graphh" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>Notez que le module <code class="docutils literal notranslate"><span class="pre">graphh</span></code> a été développé par d’anciens étudiants de Licence 2 et Licence 3 MIASHS de l’Université de Rennes 2.</p>
</aside>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="fichiers.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Interaction avec des fichiers</p>
      </div>
    </a>
    <a class="right-next"
       href="numpy.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><code class="docutils literal notranslate"><span class="pre">numpy</span></code> et le calcul matriciel</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requetes-http-en-python">Requêtes HTTP en Python</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#format-d-une-requete-http">Format d’une requête HTTP</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#utilisation-du-module-requests">Utilisation du module <code class="docutils literal notranslate"><span class="pre">requests</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercice">Exercice</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Romain Tavenard
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>